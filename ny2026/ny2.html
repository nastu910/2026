<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MIUZXC ALBUM</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Montserrat:wght@300;400&family=Playfair+Display:ital,wght@0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0f172a; 
            --paper-color: #f2eadd; 
            --text-color: #2c241e; 
            --accent-color: #eebc51; 
            --secondary-color: #a98467; 
        }

        /* RESET C∆† B·∫¢N */
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none; 
        }
        input, textarea { -webkit-user-select: auto; user-select: auto; }

        html {
            background-color: var(--bg-color);
            background: radial-gradient(ellipse at center, #1e293b 0%, #0f172a 100%);
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            background: transparent; 
            font-family: 'Dancing Script', cursive;
            color: var(--text-color);
            overflow: hidden; 
            width: 100%;
            height: 100%;
            position: fixed; 
            touch-action: none; 
            overscroll-behavior: none;
        }

        /* KHUNG CH·ª®A TO√ÄN B·ªò ƒê·ªÇ ZOOM/PAN */
        #viewport {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: visible;
            transform-origin: center center;
            transition: transform 0.1s linear;
            will-change: transform;
        }

        /* CANVAS EFFECTS */
        #snow-canvas, #fireworks-canvas {
            position: fixed;
            top: 0; left: 0;
            pointer-events: none;
            z-index: 100;
            opacity: 0.8;
        }
        #fireworks-canvas { z-index: 2000; display: none; opacity: 1; }

        #happy-new-year-text {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2500;
            text-align: center;
            display: none;
            pointer-events: none;
            width: 100%;
        }

        #happy-new-year-text h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 3.5rem;
            color: var(--accent-color);
            text-shadow: 0 0 20px rgba(238, 188, 81, 0.8);
            opacity: 0;
            transform: scale(0.5);
            transition: all 2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #happy-new-year-text.show h1 { opacity: 1; transform: scale(1); }

        /* WELCOME SCREEN */
        #welcome-screen {
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at center, #243b55 0%, #0f172a 100%);
            color: #e8e0d5;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1s ease;
        }

        .typing-text {
            font-family: 'Dancing Script', cursive;
            font-size: 1.8rem;
            margin-bottom: 2rem;
            text-align: center;
            min-height: 1.5em;
            padding: 0 20px;
            line-height: 1.6;
        }

        .btn-start {
            padding: 12px 30px;
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            background: transparent;
            cursor: pointer;
            letter-spacing: 2px;
            transition: all 0.3s;
            opacity: 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1rem;
            pointer-events: auto;
        }
        .btn-start:active { 
            background: var(--accent-color); 
            color: var(--bg-color);
        }

        /* BOOK STRUCTURE */
        .book-container { 
            perspective: 2500px; 
            display: none; 
            z-index: 10; 
            width: 450px;
            height: 580px;
            position: relative;
            transform-style: preserve-3d;
        }

        .book {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            display: flex;
            justify-content: center; 
        }

        .page {
            position: absolute;
            width: 100%; height: 100%;
            top: 0; left: 0;
            transform-origin: left;
            transform-style: preserve-3d;
            /* T·ªêI ∆ØU: Gi·∫£m th·ªùi gian xu·ªëng 0.6s v√† d√πng curve m∆∞·ª£t h∆°n */
            transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            cursor: pointer;
            will-change: transform, z-index;
        }

        .front, .back {
            position: absolute;
            width: 100%; height: 100%;
            top: 0; left: 0;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            padding: 20px 25px;
            background: var(--paper-color);
            border: 1px solid #dcd3c7;
            display: flex;
            flex-direction: column;
            /* Gi·∫£m b·ªõt shadow n·∫∑ng ƒë·ªÉ tƒÉng FPS */
            box-shadow: inset 2px 0 5px rgba(0,0,0,0.05);
            transform: translateZ(0); /* K√≠ch ho·∫°t GPU layer */
        }

        .back { 
            transform: rotateY(180deg);
            background: #ede6d8; 
            box-shadow: inset -2px 0 5px rgba(0,0,0,0.05);
        }

        .cover-front {
            background: #3e2723 !important;
            color: var(--accent-color);
            justify-content: center;
            align-items: center;
            text-align: center;
            border: 8px double var(--accent-color) !important;
        }

        .main-cover-img {
            width: 90%;
            max-height: 280px;
            object-fit: contain; 
            border: 3px solid var(--accent-color);
            margin-bottom: 25px;
            border-radius: 4px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.4);
            background: #2c241e;
        }

        .page.flipped { transform: rotateY(-180deg); }

        /* CONTROLS (ZOOM) */
        .zoom-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 4000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .zoom-btn {
            width: 40px; height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid var(--accent-color);
            color: var(--accent-color);
            font-size: 1.2rem;
            cursor: pointer;
            backdrop-filter: blur(5px);
            display: flex; justify-content: center; align-items: center;
        }
        .zoom-btn:active { background: var(--accent-color); color: #000; }

        /* MUSIC PLAYER */
        .music-player {
            position: fixed; bottom: 20px; left: 20px; z-index: 500;
            background: rgba(15, 23, 42, 0.85); color: white;
            padding: 8px 15px; border-radius: 30px; 
            font-size: 0.8rem; display: flex; align-items: center; gap: 10px;
            border: 1px solid rgba(238, 188, 81, 0.3);
            backdrop-filter: blur(5px);
            max-width: 80%; 
        }
        .song-info {
            max-width: 100px; overflow: hidden; white-space: nowrap;
            text-overflow: ellipsis; color: var(--accent-color); font-weight: bold;
        }
        .music-controls { display: flex; gap: 10px; align-items: center; }
        .music-btn { background: none; border: none; color: white; cursor: pointer; font-size: 1.1rem; padding: 5px;}

        /* GRID & POLAROID */
        .month-title {
            font-family: 'Dancing Script', cursive;
            font-size: 2rem;
            color: var(--accent-color);
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(169, 132, 103, 0.3);
            text-align: center;
        }

        .polaroid-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            grid-template-rows: 1fr 1fr;
            gap: 10px; 
            flex-grow: 1;
            align-content: start;
        }

        .polaroid {
            background: #faf9f6; 
            padding: 4px 4px 12px 4px;
            box-shadow: 2px 3px 6px rgba(0,0,0,0.1); /* Gi·∫£m shadow */
            transform: rotate(var(--r));
            text-align: center;
            height: 160px; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transform: translateZ(0) rotate(var(--r));
            will-change: transform;
        }
        .polaroid img, .polaroid video { 
            width: 100%; 
            height: 115px; 
            object-fit: cover; 
            background: #eee; 
            border: 1px solid #ddd; 
            pointer-events: none; 
        }
        .polaroid img.zoomable, .polaroid video.zoomable-video { pointer-events: auto; }

        .polaroid small { 
            font-size: 0.6rem; 
            font-family: 'Dancing Script', cursive; 
            color: #444; 
            padding-top: 3px;
            display: block;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .full-img {
            width: 100%; 
            height: 300px; 
            object-fit: contain; 
            background: #fdfdfd; 
            border: 5px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .desc { 
            font-size: 1rem;
            line-height: 1.4; 
            font-style: italic; 
            color: var(--text-color); 
            opacity: 0.9; 
            margin-top: 10px; 
            text-align: center; 
        }

        .page-note {
            margin-top: 10px;
            font-size: 0.9rem;
            line-height: 1.3;
            color: #5d534a;
            font-style: italic;
            text-align: center;
            min-height: 1.2em;
            border-top: 1px dashed rgba(169, 132, 103, 0.2);
            padding-top: 8px;
        }

        /* ZOOM MODAL STYLES */
        .image-modal {
            display: none;
            position: fixed;
            z-index: 5000;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            max-width: 95%;
            max-height: 90%;
            border: 3px solid white;
            border-radius: 4px;
            background: white;
            animation: zoomIn 0.3s ease forwards;
            object-fit: contain;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.8); } to { transform: scale(1); } }

        /* VOICE & VIDEO */
        .voice-card, .video-card {
            background: rgba(169, 132, 103, 0.1);
            border: 1px dashed var(--secondary-color);
            border-radius: 10px;
            padding: 10px;
            margin-top: 8px;
            text-align: center;
        }
        .video-container {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid white;
            margin-top: 5px;
        }
        .btn-voice {
            background: var(--secondary-color);
            color: white; border: none; padding: 6px 12px; border-radius: 20px;
            cursor: pointer; font-family: inherit; margin: 5px auto; font-size: 0.9rem;
        }

        #note-2026 {
            width: 100%; height: 80px; margin-top: 10px; 
            background: rgba(255,255,255,0.1); border: 1px solid var(--accent-color); 
            color: white; padding: 10px; font-family: inherit;
        }

        .sticker { position: absolute; bottom: 10px; right: 10px; font-size: 1.5rem; }
        .hidden { display: none !important; }
        .fade-in { opacity: 1 !important; }

        #swipe-hint {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.5);
            font-family: 'Montserrat', sans-serif;
            font-size: 0.8rem;
            pointer-events: none;
            z-index: 60;
            animation: pulse 2s infinite;
            display: none;
        }
        @keyframes pulse { 0% { opacity: 0.3; } 50% { opacity: 0.8; } 100% { opacity: 0.3; } }

    </style>
</head>
<body>
    <canvas id="snow-canvas"></canvas>
    <canvas id="fireworks-canvas"></canvas>

    <div id="happy-new-year-text"><h1>Happy New Year 2026</h1></div>

    <div id="image-modal" class="image-modal">
        <div id="modal-container" style="display: flex; justify-content: center; align-items: center; width:100%; height:100%;"></div>
    </div>

    <div class="zoom-controls">
        <button class="zoom-btn" id="btn-zoom-in" title="Zoom In">+</button>
        <button class="zoom-btn" id="btn-zoom-out" title="Zoom Out">-</button>
        <button class="zoom-btn" id="btn-reset" title="Reset">‚Ü∫</button>
    </div>

    <div class="music-player">
        <div class="music-controls">
            <button id="prev-song" class="music-btn">‚èÆ</button>
            <button id="play-pause" class="music-btn">‚ñ∂</button>
            <button id="next-song" class="music-btn">‚è≠</button>
        </div>
        <div class="song-info" id="song-title">ƒêang t·∫£i...</div>
        <audio id="bg-music"></audio>
    </div>

    <div id="welcome-screen">
        <div class="typing-text" id="typewriter"></div>
        <button class="btn-start" id="btn-start">ƒêI ƒê·∫æN ALBUM</button>
    </div>

    <div id="swipe-hint">C√≥ th·ªÉ ph√≥ng to thu nh·ªè Album</div>

    <div id="viewport">
        <div class="book-container" id="book-container">
            <div class="book" id="myBook">
                
                <div class="page" id="page-0" data-page="0">
                    <div class="front cover-front">
                        <img src="https://i.postimg.cc/mg8CH9xR/pic0.png" alt="Cover" class="main-cover-img">
                        <h1>MIUZXC 2025 ALBUM</h1>
                        <p>‚Äî C√πng xem l·∫°i m·ªôt nƒÉm qua ‚Äî</p>
                        <small style="margin-top: 20px; opacity: 0.8;">Ch·∫°m ƒë·ªÉ m·ªü album</small>
                    </div>
                    <div class="back">
                        <h2 class="month-title">MOMENT</h2>
                        <img src="https://i.postimg.cc/yNb8DqTQ/pic1.png" class="full-img zoomable">
                        <p class="desc">"Nh·ªØng moments v·ªÅ m·∫•y ng t√≠ch g√≥p ƒë∆∞·ª£c c·∫£ nƒÉm qua"</p>
                        <span class="sticker">‚ú®</span>
                    </div>
                </div>

                <div class="page" id="page-1" data-page="1">
                    <div class="front">
                        <h2 class="month-title">Opening Words</h2>
                        <p class="desc" style="font-size: 1.1rem; text-align: left;">Dear Miu 2025,<br>
                            <br> L√∫c ƒë·∫ßu mu·ªën t·∫∑ng g√¨ ƒë√≥ cho m·∫•y ng, xong hok bik t·∫∑ng g√¨, r·ªìi c√≥ √Ω t∆∞·ªüng l√† l√†m m·ªôt cu·ªën album v·ªÅ m·∫•y ng trong m·ªôt nƒÉm qua.<br>
                            <br> Chi·∫øc album nh·ªè n√†y tui l√†m t·ªïng h·ª£p c√°c h√¨nh ·∫£nh t·ª´ social, pm v·ªÅ m·∫•y ng m·ªôt nƒÉm qua.<br>
                            <br> Ph·∫ßn nh·∫°c coi nh∆∞ t√¥i ƒë√°nh c∆∞·ª£c ik, tuy ƒëc cho t√™n nh·∫°c r·ªìi, nh∆∞ng tui ch·ªçn nh·∫°c theo c·∫£m t√≠nh, mong l√† s·∫Ω t√¢m ƒë·∫ßu √Ω h·ª£p v·ªõi gu nh·∫°c c·ªßa m·∫•y ng. Tui c√≥ add th√™m 1 b√†i kh√°c v√¥, cho l√† b√†i n√†y s·∫Ω n√≥i ra m·ªôt ch√∫t t·∫•m l√≤ng c·ªßa tui d√†nh cho m·∫•y ng.<br>
                            <br> ƒê√¢y l√† l·∫ßn ƒë·∫ßu ti√™n tui l√†m c√°i n√†y, n·∫øu c√≥ sai s√≥t g√¨ h√£y b·ªè qua cho tui.</p>
                        <span class="sticker">‚úçÔ∏è</span>
                    </div>
                    <div class="back" id="jan-first-half"></div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const albumData = {
            "January": [
                { url: "https://i.postimg.cc/3NYZ4KPp/pic1_t1.png", caption: "hihi v·ª´a win game üòä" },
                { url: "https://i.postimg.cc/WzT7F2Qq/pic2_t1.png", caption: "hentai üòí" }
            ],
            "February": [{ url: "https://i.postimg.cc/pry8wp8m/pic1_t2.png", caption: "ü•¥" }],
            "March": [
                { url: "https://i.postimg.cc/qvYkwgBQ/pic1_t3.png", caption: "„Éæ(Ôº†‚åí„Éº‚åíÔº†)„Éé" },
                { url: "https://i.postimg.cc/CxtF7dM6/pic2_t3.png", caption: "(‚óèÀá‚àÄÀá‚óè)" }
            ],
            "April": [{ url: "https://i.postimg.cc/wjJ6Wgt7/pic1_t4.png", caption: "Cute üòçü©∑" }],
            "May": [
                { url: "https://i.postimg.cc/SNbqJHTL/pic1_t5.png", caption: "Nay xinh ch·ª•p cho t·∫•m ü•∞" },
                { url: "https://i.postimg.cc/52xVmLMk/pic2_t5.png", caption: "‚ù§Ô∏è" },
                { url: "https://i.postimg.cc/x1jwmQKR/pic3_t5.png", caption: "ü©µ" },
                { url: "https://i.postimg.cc/Z5gwqzjS/pic4_t5.png", caption: "üñ§" },
            ],
            "June": [
                { url: "https://i.postimg.cc/nrSHW1fQ/pic1_t6.png", caption: "(*^‚ñΩ^*)" },
                { url: "https://i.postimg.cc/h42PhKQK/pic2_t6.png", caption: "`(*>Ôπè<*)‚Ä≤" },
                { url: "https://i.postimg.cc/zv2JQkYV/pic3_t6.png", caption: "(‚úø‚ó†‚Äø‚ó†)" },
                { url: "https://i.postimg.cc/fW8TkMSR/pic4_t6.png", caption: "(‚âß‚àá‚â¶)" },
                { url: "https://i.postimg.cc/Cx0HcCJx/pic5_t6.png", caption: "o((>œâ< ))o" },
                { url: "https://i.postimg.cc/y8KXLhnd/pic6_t6.png", caption: "( ‚Ä¢ÃÄ œâ ‚Ä¢ÃÅ )" },
                { url: "https://i.postimg.cc/y8KXLhnJ/pic7_t6.png", caption: "o((>œâ< ))o" },
                { url: "https://i.postimg.cc/4xGbWvw7/pic8_t6.png", caption: "(‚ùÅ¬¥‚ó°`‚ùÅ)" }
            ],
            "July": [
                { url: "https://i.postimg.cc/RZmQg1Gm/pic1_t7.png", caption: "( ‚Ä¢ÃÄ œâ ‚Ä¢ÃÅ )‚úß" },
                { url: "https://i.postimg.cc/y8KXLhnB/pic2_t7.png", caption: "q(‚âß‚ñΩ‚â¶q)" },
                { url: "https://i.postimg.cc/vZyL07Xb/pic3_t7.png", caption: "(^„Éªœâ„Éª^ )" },
                { url: "https://i.postimg.cc/RZmQg1GB/pic4_t7.png", caption: "(o„Çú‚ñΩ„Çú)o‚òÜ" },
                { url: "https://i.postimg.cc/htnb28MG/pic5_t7.png", caption: "‚ú™ œâ ‚ú™" },
                { url: "https://i.postimg.cc/htnb28Mv/pic6_t7.png", caption: "(‚úø‚óï‚Äø‚óï‚úø)" },
                { url: "https://i.postimg.cc/c4FwcqKF/pic7_t7.png", caption: "(. ‚ùõ ·¥ó ‚ùõ.)" },
                { url: "https://i.postimg.cc/zXxKkmLt/pic8_t7.png", caption: "(„ÄÇ„Éªœâ„Éª„ÄÇ)" }
            ],
            "August": [
                { url: "https://i.postimg.cc/Hs6XtGJ7/pic1_t8.png", caption: "Pretty" },
                { url: "https://i.postimg.cc/Nfdmxhyy/pic2_t8.png", caption: "Shining" },
                { url: "https://i.postimg.cc/Wb5g7RDF/pic3_t8.png", caption: "Lovely" },
                { url: "https://i.postimg.cc/fT8mv43X/pic4_t8.png", caption: "Sweet" },
                { url: "https://i.postimg.cc/sDT7JFBP/pic5_t8.png", caption: "Hey" },
                { url: "https://i.postimg.cc/m2mCSxcN/pic6_t8.png", caption: "Tiny" },
                { url: "https://i.postimg.cc/02VDCg6t/pic7_t8.png", caption: "üíå" },
                { url: "https://i.postimg.cc/FHjfn2zV/pic8_t8.png", caption: "Charming" }
            ],
            "September": [
                { url: "https://i.postimg.cc/2SpbGzkv/pic1_t9.png", caption: "ü§ó" },
                { url: "https://i.postimg.cc/rw60j8V1/pic2_t9.png", caption: "üòä" },
                { url: "https://i.postimg.cc/Njh9Dgs8/pic3_t9.png", caption: "‚ò∫Ô∏è" },
                { url: "https://i.postimg.cc/VkyrgYfB/pic4_t9.png", caption: "ü§©" },
                { url: "https://i.postimg.cc/RZr6dMSX/pic5_t9.png", caption: "üòó" },
                { url: "https://i.postimg.cc/Njh9Dgsz/pic6_t9.png", caption: "üòô" },
                { url: "https://i.postimg.cc/QdpBnRCq/pic7_t9.png", caption: "üòö" },
                { url: "https://i.postimg.cc/YC14yJ03/pic8_t9.png", caption: "üòò" }
            ],
            "October": [
                { url: "https://i.postimg.cc/jSLTDN0c/pic1_t10.png", caption: "Kawaii ü•∞" },
                { url: "https://i.postimg.cc/bwsPZbcT/pic2_t10.png", caption: "Adorable ‚ù§Ô∏è" },
                { url: "https://i.postimg.cc/BnX3jD9B/pic3_t10.png", caption: "Kiss kiss üíã" },
                { url: "https://i.postimg.cc/9XZBpLZ2/pic4_t10.png", caption: "Bunny üê∞" },
                { url: "https://i.postimg.cc/zDKkjxKY/pic5_t10.png", caption: "Little crazy ü§™" },
                { url: "https://i.postimg.cc/VsnFRKn8/pic6_t10.png", caption: "Precious" },
                { url: "https://i.postimg.cc/GmHR4YwV/pic7_t10.png", caption: "1 ch√∫t th√†nh t·ª±u nh·ªè c·ªßa nƒÉm üèÜ" },
                { url: "./video/video1_t10.mp4", caption: "Chill chill get home" },
            ],
            "November": [
                { url: "./video/videot11.mp4", caption: "Cool" },
                { url: "https://i.postimg.cc/ZqvNqqxV/pic1_t11.png", caption: "(‚ù§Ô∏è œâ ‚ù§Ô∏è)" },
                { url: "https://i.postimg.cc/mr19rryX/pic2_t11.png", caption: "(‚òÖ œâ ‚òÖ)" },
                { url: "https://i.postimg.cc/rpR4ppNZ/pic3_t11.png", caption: "(^‚óï.‚óï^)" },
                { url: "https://i.postimg.cc/zv2DWCJ2/pic4_t11.png", caption: "Meow üò∏" },
                { url: "https://i.postimg.cc/5tQzttSs/pic5_t11.png", caption: "(*‚úß√ó‚úß*)" },
                { url: "./video/video1_t11.mp4", caption: "UwU" }
            ],
            "December": [
                { url: "https://i.postimg.cc/5yybxXwY/pic1_t12.png", caption: "Beautiful üíï" },
                { url: "https://i.postimg.cc/zvv8Jyn3/pic2_t12.png", caption: "Angel ü™Ω" },
                { url: "https://i.postimg.cc/T11fRKrK/pic3_t12.png", caption: "Gorgeous ‚ú®" },
                { url: "https://i.postimg.cc/NFFBgK15/pic4_t12.png", caption: "Stunning ‚ù§Ô∏è‚Äçüî•" },
                { url: "./video/video1_t12.mp4", caption: "Still cute üíñ" },
                { url: "./video/video2_t12.mp4", caption: "Hi ‚úåÔ∏è" }
            ]
        };

        const monthNotes = {
            "January": [
                "Nh·ªØng th√°ng ƒë·∫ßu h√¨nh v·ªÅ m·∫•y ng hok ƒëc nh√¨u.",
                "L√∫c ƒë∆∞a h√¨nh v√¥ ƒë√¢y c√≥ b·ªã b√≥p, c·∫Øt b·ªõt ·∫£nh, n√™n tui c√≥ th√™m t√≠nh nƒÉng ph√≥ng to ·∫£nh, ph√≤ng tr∆∞·ªùng h·ª£p c·∫ßn xem ·∫£nh r√µ h∆°n."
            ],
            "February": [
                "T·∫•m m·∫∑t m·ªôc duy nh·∫•t, h√¥m ƒë√≥ ch·∫Øc say qu√° xong g·ª≠i cho tui xem."
            ],
            "March": ["Album n√†y tui ch·ªçn l·ªçc m·∫•y t·∫•m nh√¨n d·ªãu d·ªãu, k√≠n ƒë√°o nh·∫•t c√≥ th·ªÉ üòë."], 
            "April": ["Moment cute hok th·ªÉ qu√™n üôÑ."],
            "May": ["ü§ç‚ù§Ô∏èü©µüñ§"],
            "June": ["T·∫ßm gi·ªØa nƒÉm m·ªõi t·ªïng h·ª£p ƒëc nh√¨u h√¨nh h∆°n t√≠.", 
            "C√≥ th√°ng h√¨nh nhi·ªÅu, n√™n l√† m·∫•y th√°ng sau c√≥ ·∫£nh x·∫øp hok ƒë√∫ng th√°ng, n√™n c≈©ng ƒë·ª´ng ƒë·ªÉ √Ω qu√° nha."],
            "July": ["L√∫c n√†y ch∆°i v·ªõi bn xong c√≥ m·∫•y tattoo m·ªõi."],
            "August": ["Vibe n√†ng th∆° ü§ç."],
            "September": ["C√≥ nh·ªØng h√¨nh hok bik ghi g√¨, n√™n ƒë·ªÉ icon thay t·∫°m nha."],
            "October": ["Th√°ng n√†y 2 c√≥ s·ª± ki·ªán. 1 l√† update b·∫£n th√¢n.", 
            "2 l√† ƒë∆∞·ª£c ƒë·ªÅ c·ª≠ h·∫°ng m·ª•c Teen Creator of the Year t·∫°i xHamster Awards 2025."],
            "November": ["Th√°ng n√†y ƒëang trong kho·∫£ng thgian ngh·ªâ ng∆°i sau update."],
            "December": ["T√≥c m·ªõi", 
            "ƒê√¢y l√† nh·ªØng g√¨ tui t·ªïng h·ª£p ƒë∆∞·ª£c.\n Mong l√† nƒÉm sau s·∫Ω t·ªïng h·ª£p ƒë∆∞·ª£c nhi·ªÅu h∆°n"
        ]
        };

        const months = Object.keys(albumData);
        const book = document.getElementById('myBook');

        function isVideo(url) {
            return url.match(/\.(mp4|webm|ogg|mov)$/i) || url.includes('video');
        }

        function createGridHTML(monthName, dataArray, noteText = "") {
            if (!dataArray || dataArray.length === 0) {
                return `<h2 class="month-title">${monthName}</h2><div class="page-note">${noteText}</div>`;
            }

            return `
                <h2 class="month-title">${monthName}</h2>
                <div class="polaroid-grid">
                    ${dataArray.map((item, i) => {
                        const captionText = item.caption || "2025 Memory";
                        if (isVideo(item.url)) {
                            return `
                                <div class="polaroid" style="--r: ${i % 2 === 0 ? '-2deg' : '2deg'}">
                                    <video src="${item.url}" muted loop autoplay playsinline class="zoomable-video"></video>
                                    <small>${captionText}</small>
                                </div>`;
                        } else {
                            return `
                                <div class="polaroid" style="--r: ${i % 2 === 0 ? '-2deg' : '2deg'}">
                                    <img src="${item.url}" class="zoomable">
                                    <small>${captionText}</small>
                                </div>`;
                        }
                    }).join('')}
                </div>
                <div class="page-note">${noteText}</div>
            `;
        }

        // Setup Page 0 & 1 are explicitly in HTML. Setup content for Page 1 Back.
        document.getElementById('jan-first-half').innerHTML = createGridHTML("January", albumData["January"].slice(0, 4), monthNotes["January"][0]);
        // Set initial Z-Index for Page 0 and 1
        document.getElementById('page-0').style.zIndex = 50;
        document.getElementById('page-1').style.zIndex = 49;


        months.forEach((m, index) => {
            const p = document.createElement('div');
            p.className = 'page';
            
            // Logic x·∫øp Z-index tƒ©nh (khi ch∆∞a l·∫≠t): Trang ƒë·∫ßu cao nh·∫•t, trang sau th·∫•p d·∫ßn
            p.style.zIndex = 50 - (index + 2); // +2 v√¨ ƒë√£ c√≥ page 0 v√† 1
            p.dataset.page = index + 2; 
            
            const note2 = (monthNotes[m] && monthNotes[m][1]) ? monthNotes[m][1] : "";
            const frontHTML = `<div class="front">${createGridHTML(m, albumData[m].slice(4, 8), note2)}</div>`;
            
            let backHTML = '<div class="back"></div>';
            if (index < months.length - 1) {
                const nextM = months[index+1];
                const note1 = (monthNotes[nextM] && monthNotes[nextM][0]) ? monthNotes[nextM][0] : "";
                backHTML = `<div class="back">${createGridHTML(nextM, albumData[nextM].slice(0, 4), note1)}</div>`;
            } else {
                backHTML = `
                    <div class="back">
                        <h2 class="month-title">Closing Words</h2>
                        <img src="https://i.postimg.cc/gJw31s3R/pic3.png" class="full-img zoomable">
                        <p class="desc">NƒÉm nay ƒë·∫°t ƒë∆∞·ª£c nhi·ªÅu th√†nh t·ª±u, nƒÉm sau c·ªë g·∫Øng ƒë·∫°t nhi·ªÅu h∆°n n·ªØa.</p>
                        <span class="sticker">‚ù§Ô∏è</span>
                    </div>
                `;
            }
            p.innerHTML = frontHTML + backHTML;
            book.appendChild(p);
        });

        const summaryPage = document.createElement('div');
        summaryPage.className = 'page';
        summaryPage.style.zIndex = 50 - (months.length + 2);
        summaryPage.dataset.page = months.length + 2;
        summaryPage.innerHTML = `
            <div class="front" style="overflow-y: auto;">
                <h2 class="month-title">Share Little Moments</h2>
                <div class="voice-card">
                    <p style="font-size:0.8rem; font-weight:bold;">üéß </p>
                    <button id="btn-voice-play" class="btn-voice"><span>‚ñ∂</span> Nghe Voice</button>
                    <audio id="voice-message"><source src="" type="audio/mpeg"></audio>
                </div>
                <div class="video-card">
                    <p style="font-size:0.8rem; font-weight:bold;">üé¨</p>
                    <div class="video-container">
                        <video width="100%" controls><source src="./video/thanks.mp4" type="video/mp4"></video>
                    </div>
                </div>
            </div>
            <div class="back">
                <h2 class="month-title">A Little Message</h2>
                <img src="https://i.postimg.cc/zvv8Jyn3/pic2_t12.png" class="full-img zoomable">
                <p class="desc">M·ªôt nƒÉm qua vui c√≥, bu·ªìn c√≥, nh∆∞ng c≈©ng l√† m·ªôt nƒÉm ƒë√°ng nh·ªõ. B·ªè qua m·ªçi mu·ªôn phi·ªÅn c·ªßa nƒÉm nay, chu·∫©n b·ªã h√†nh trang cho m·ªôt nƒÉm m·ªõi.
                    <br>Ch√∫c Miu nƒÉm m·ªõi vui v·∫ª, g·∫∑p nhi·ªÅu may m·∫Øn, c√¥ng vi√™c thu·∫≠n l·ª£i, gia ƒë√¨nh b√¨nh an v√† h·∫°nh ph√∫c.</p>
            </div>
        `;
        book.appendChild(summaryPage);

        const finalPage = document.createElement('div');
        finalPage.className = 'page';
        finalPage.style.zIndex = 50 - (months.length + 3);
        finalPage.dataset.page = months.length + 3;
        finalPage.innerHTML = `
            <div class="front cover-front" style="padding: 20px;">
                <h2 style="font-family:'Dancing Script'; color:var(--accent-color); font-size: 2rem;">G·ª≠i 2026</h2>
                <textarea id="note-2026" placeholder="..."></textarea>
                <button id="btn-close" style="margin-top: 15px; padding: 12px; cursor: pointer; border: none; width: 100%; background: var(--accent-color); font-weight: bold; font-family: 'Montserrat';">T·∫†M BI·ªÜT 2025</button>
            </div>
            <div class="back cover-front"><h1>THE END</h1><p>2025</p></div>
        `;
        book.appendChild(finalPage);

        // --- PAGE FLIP LOGIC (OPTIMIZED FOR SPEED) ---
        let isFlipping = false;

        function flipPage(pageElement, forceState = null) {
            if (isFlipping) return;
            
            const pageNum = parseInt(pageElement.dataset.page || 0);
            const isCurrentlyFlipped = pageElement.classList.contains('flipped');
            let shouldFlip = forceState !== null ? forceState : !isCurrentlyFlipped;

            if (shouldFlip === isCurrentlyFlipped) return;

            isFlipping = true;

            if (shouldFlip) {
                // L·∫¨T ƒêI (Ph·∫£i -> Tr√°i)
                pageElement.style.zIndex = 200 + pageNum; 
                pageElement.classList.add('flipped');

                // TƒÉng t·ªëc ƒë·ªô tr·∫£ l·∫°i tr·∫°ng th√°i (600ms thay v√¨ 800ms)
                setTimeout(() => {
                    pageElement.style.zIndex = 50 + pageNum;
                    isFlipping = false;
                }, 600);

            } else {
                // L·∫¨T V·ªÄ (Tr√°i -> Ph·∫£i)
                pageElement.style.zIndex = 200 + pageNum; 
                pageElement.classList.remove('flipped');

                setTimeout(() => {
                    pageElement.style.zIndex = 50 - pageNum; 
                    isFlipping = false;
                }, 600);
            }
        }

        // --- ZOOM & PAN LOGIC ---
        let currentScale = 1;
        let startX = 0, startY = 0;
        let transX = 0, transY = 0;
        let isDragging = false;
        let isMoved = false; 
        const viewport = document.getElementById('viewport');
        const bookContainer = document.getElementById('book-container');

        // Auto-fit function
        function autoFitBook() {
            const screenW = window.innerWidth;
            const bookW = 450; 
            if (screenW < 500) {
                currentScale = (screenW / bookW) * 0.95; // 95% width
            } else {
                currentScale = 1;
            }
            updateTransform();
        }

        function updateTransform() {
            viewport.style.transform = `translate(${transX}px, ${transY}px) scale(${currentScale})`;
        }

        document.getElementById('btn-zoom-in').addEventListener('click', () => {
            currentScale += 0.2; updateTransform();
        });
        document.getElementById('btn-zoom-out').addEventListener('click', () => {
            if(currentScale > 0.4) currentScale -= 0.2; 
            updateTransform();
        });
        document.getElementById('btn-reset').addEventListener('click', () => {
            currentScale = 1; transX = 0; transY = 0; autoFitBook();
            updateTransform();
        });

        // Touch handling for Pan (Drag) & Pinch
        let initialPinchDistance = null;
        let initialScale = 1;

        viewport.addEventListener('touchstart', (e) => {
            if (e.target.tagName === 'AUDIO' || e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;

            if (e.touches.length === 2) {
                // Pinch start
                isDragging = false;
                initialPinchDistance = Math.hypot(
                    e.touches[0].pageX - e.touches[1].pageX,
                    e.touches[0].pageY - e.touches[1].pageY
                );
                initialScale = currentScale;
            } else if (e.touches.length === 1) {
                // Drag start
                isDragging = true;
                isMoved = false;
                startX = e.touches[0].pageX - transX;
                startY = e.touches[0].pageY - transY;
            }
        }, {passive: false});

        viewport.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2 && initialPinchDistance) {
                // Pinch move
                e.preventDefault(); 
                const dist = Math.hypot(
                    e.touches[0].pageX - e.touches[1].pageX,
                    e.touches[0].pageY - e.touches[1].pageY
                );
                const scaleFactor = dist / initialPinchDistance;
                currentScale = initialScale * scaleFactor;
                updateTransform();
            } else if (e.touches.length === 1 && isDragging) {
                // Drag move
                const dx = Math.abs(e.touches[0].pageX - (startX + transX));
                const dy = Math.abs(e.touches[0].pageY - (startY + transY));
                
                if (dx > 5 || dy > 5) {
                    isMoved = true;
                    e.preventDefault(); 
                    transX = e.touches[0].pageX - startX;
                    transY = e.touches[0].pageY - startY;
                    updateTransform();
                }
            }
        }, {passive: false});

        viewport.addEventListener('touchend', () => {
            isDragging = false;
            initialPinchDistance = null;
        });

        // Mouse Drag (for desktop testing)
        viewport.addEventListener('mousedown', e => {
            if (e.target.tagName === 'BUTTON' || e.target.tagName === 'INPUT' || e.target.closest('.music-player')) return;
            isDragging = true;
            isMoved = false;
            startX = e.clientX - transX;
            startY = e.clientY - transY;
            viewport.style.cursor = 'grabbing';
        });
        window.addEventListener('mousemove', e => {
            if (!isDragging) return;
            const dx = Math.abs(e.clientX - (startX + transX));
            const dy = Math.abs(e.clientY - (startY + transY));
            if (dx > 5 || dy > 5) {
                 isMoved = true;
                 e.preventDefault();
                 transX = e.clientX - startX;
                 transY = e.clientY - startY;
                 updateTransform();
            }
        });
        window.addEventListener('mouseup', () => {
            isDragging = false;
            viewport.style.cursor = 'default';
        });


        // --- SWIPE TO FLIP LOGIC ---
        let touchStartX = 0;
        let touchEndX = 0;
        
        bookContainer.addEventListener('touchstart', e => {
            touchStartX = e.changedTouches[0].screenX;
        }, {passive: true});

        bookContainer.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            if (!isMoved) handleSwipe();
        }, {passive: true});

        function handleSwipe() {
            const threshold = 50; 
            if (touchEndX < touchStartX - threshold) {
                flipNextPage();
            }
            if (touchEndX > touchStartX + threshold) {
                flipPrevPage();
            }
        }

        function flipNextPage() {
            const pages = document.querySelectorAll('.page');
            for (let i = 0; i < pages.length; i++) {
                if (!pages[i].classList.contains('flipped')) {
                    flipPage(pages[i], true);
                    return;
                }
            }
        }

        function flipPrevPage() {
            const pages = Array.from(document.querySelectorAll('.page')).reverse();
            for (let i = 0; i < pages.length; i++) {
                if (pages[i].classList.contains('flipped')) {
                    flipPage(pages[i], false);
                    return;
                }
            }
        }

        const modal = document.getElementById('image-modal');
        const modalContainer = document.getElementById('modal-container');

        function initActions() {
            const allPages = document.querySelectorAll('.page');
            allPages.forEach((page, index) => {
                
                page.addEventListener('click', function(e) {
                    if (isMoved || isFlipping) return;

                    if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'BUTTON' || (e.target.tagName === 'VIDEO' && e.target.hasAttribute('controls')) || e.target.closest('.music-player')) return;
                    
                    if (e.target.classList.contains('zoomable') || e.target.classList.contains('zoomable-video')) {
                        e.stopPropagation();
                        modal.style.display = "flex";
                        modalContainer.innerHTML = "";
                        if (e.target.tagName === 'VIDEO') {
                            const v = document.createElement('video'); v.src = e.target.src; v.controls = true; v.autoplay = true; v.className = "modal-content";
                            modalContainer.appendChild(v);
                        } else {
                            const img = document.createElement('img'); img.src = e.target.src; img.className = "modal-content";
                            modalContainer.appendChild(img);
                        }
                        return;
                    }

                    if (this.classList.contains('flipped')) {
                        flipPage(this, false);
                    } else {
                        flipPage(this, true);
                    }
                });
            });
            modal.onclick = () => { modal.style.display = "none"; modalContainer.innerHTML = ""; };
        }
        setTimeout(initActions, 100);

        /* --- NH·∫†C N·ªÄN --- */
        const playlist = [
            { title: "Make It Right", src: "./music/Make_It_Right.mp3" },
            { title: "Love On Replay", src: "./music/Love_On_Replay.mp3" },
            { title: "golden hour", src: "./music/golden_hour.mp3" },
            { title: "No Reason", src: "./music/No_Reason.mp3" },
            { title: "Cho Em An To√†n", src: "./music/Cho_Em_An_Toan.mp3" }
        ];
        
        let currentSongIndex = 0;
        const bgMusic = document.getElementById('bg-music');
        const songTitle = document.getElementById('song-title');
        const playBtn = document.getElementById('play-pause');
        const nextBtn = document.getElementById('next-song');
        const prevBtn = document.getElementById('prev-song');

        function loadSong(index) { 
            bgMusic.src = playlist[index].src; 
            songTitle.innerText = playlist[index].title; 
        }

        function playSong() {
            bgMusic.play().catch(e => console.log("C·∫ßn t∆∞∆°ng t√°c ƒë·ªÉ ph√°t nh·∫°c"));
            playBtn.innerText = "‚è∏";
        }

        playBtn.addEventListener('click', () => {
            if (bgMusic.paused) { playSong(); }
            else { bgMusic.pause(); playBtn.innerText = "‚ñ∂"; }
        });

        nextBtn.addEventListener('click', () => {
            currentSongIndex = (currentSongIndex + 1) % playlist.length;
            loadSong(currentSongIndex);
            playSong();
        });

        prevBtn.addEventListener('click', () => {
            currentSongIndex = (currentSongIndex - 1 + playlist.length) % playlist.length;
            loadSong(currentSongIndex);
            playSong();
        });

        bgMusic.addEventListener('ended', () => { nextBtn.click(); });
        loadSong(currentSongIndex);

        /* --- WELCOME --- */
        const welcomeText = "Hey\nM·ªôt nƒÉm n·ªØa l·∫°i tr√¥i qua\nTui c√≥ l√†m m·ªôt album nh·ªè v·ªÅ m·∫•y ng, m√¨nh c√πng xem nha\n Mong l√† m·∫•y ng s·∫Ω th√≠ch n√≥";
        let charIdx = 0;
        function typeWriter() {
            if (charIdx < welcomeText.length) {
                document.getElementById("typewriter").innerHTML += welcomeText.charAt(charIdx) === '\n' ? '<br>' : welcomeText.charAt(charIdx);
                charIdx++; setTimeout(typeWriter, 60);
            } else { document.getElementById("btn-start").classList.add("fade-in"); }
        }
        window.onload = function() {
            typeWriter();
            resizeSnow();
        };

        document.getElementById('btn-start').addEventListener('click', () => {
            document.getElementById('welcome-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('welcome-screen').classList.add('hidden');
                document.getElementById('book-container').style.display = 'block';
                document.getElementById('swipe-hint').style.display = 'block';
                setTimeout(() => { document.getElementById('swipe-hint').style.display = 'none'; }, 5000);
                autoFitBook(); 
                playSong();
            }, 1000);
        });

        /* --- SNOW --- */
        const snowCanvas = document.getElementById('snow-canvas');
        const sctx = snowCanvas.getContext('2d');
        let snowParticles = [];
        function resizeSnow() { snowCanvas.width = window.innerWidth; snowCanvas.height = window.innerHeight; }
        window.addEventListener('resize', () => {
            resizeSnow();
            autoFitBook();
        });
        
        class Snowflake {
            constructor() { this.reset(); }
            reset() { this.x = Math.random() * snowCanvas.width; this.y = Math.random() * -snowCanvas.height; this.radius = Math.random() * 3 + 1; this.speed = Math.random() * 1 + 0.5; this.opacity = Math.random() * 0.5 + 0.3; }
            update() { this.y += this.speed; if (this.y > snowCanvas.height) this.reset(); }
            draw() { sctx.beginPath(); sctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); sctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`; sctx.fill(); }
        }
        for (let i = 0; i < 70; i++) snowParticles.push(new Snowflake());
        function animateSnow() { sctx.clearRect(0, 0, snowCanvas.width, snowCanvas.height); snowParticles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(animateSnow); }
        animateSnow();

        /* --- FIREWORKS & CLOSE --- */
        document.getElementById('btn-close').addEventListener('click', () => {
            const fCanvas = document.getElementById('fireworks-canvas');
            const fctx = fCanvas.getContext('2d');
            const nyText = document.getElementById('happy-new-year-text');
            document.getElementById('myBook').style.transform = "scale(0) rotateY(-180deg)";
            document.getElementById('myBook').style.opacity = "0";
            // Hide Zoom Controls
            document.querySelector('.zoom-controls').style.display = 'none';
            setTimeout(() => {
                document.getElementById('book-container').style.display = "none";
                fCanvas.style.display = "block"; nyText.style.display = "block";
                setTimeout(() => { nyText.classList.add('show'); }, 100);
                fCanvas.width = window.innerWidth; fCanvas.height = window.innerHeight;
                let fwParticles = [];
                function animateFW() {
                    fctx.fillStyle = 'rgba(15, 23, 42, 0.2)'; fctx.fillRect(0,0,fCanvas.width, fCanvas.height);
                    if (Math.random() < 0.1) {
                        let x = Math.random()*fCanvas.width, y = Math.random()*fCanvas.height*0.5, color = `hsl(${Math.random()*360}, 100%, 50%)`;
                        for(let i=0; i<30; i++) fwParticles.push({x, y, color, vel:{x:(Math.random()-0.5)*10, y:(Math.random()-0.5)*10}, alpha:1});
                    }
                    fwParticles.forEach((p, i) => {
                        p.x += p.vel.x; p.y += p.vel.y; p.alpha -= 0.01;
                        if (p.alpha <= 0) fwParticles.splice(i, 1);
                        else { fctx.globalAlpha = p.alpha; fctx.beginPath(); fctx.arc(p.x, p.y, 2, 0, Math.PI*2); fctx.fillStyle = p.color; fctx.fill(); }
                    });
                    requestAnimationFrame(animateFW);
                }
                animateFW();
            }, 1000);
        });

        // --- X·ª¨ L√ù VOICE PLAYER (FIXED) ---
        document.addEventListener('click', function(e) {
            // D√πng closest ƒë·ªÉ b·∫Øt s·ª± ki·ªán k·ªÉ c·∫£ khi click v√†o th·∫ª span (icon) b√™n trong button
            const btn = e.target.closest('#btn-voice-play');
            
            if (btn) {
                const v = document.getElementById('voice-message');
                if (!v) return;

                // Th√™m s·ª± ki·ªán t·ª± ƒë·ªông reset n√∫t khi h·∫øt nh·∫°c
                v.onended = function() {
                    btn.innerHTML = "<span>‚ñ∂</span> Nghe Voice";
                };

                if (v.paused) {
                    v.play();
                    btn.innerHTML = "<span>‚è∏</span> ƒêang Ph√°t";
                } else {
                    v.pause(); // Cho ph√©p d·ª´ng
                    btn.innerHTML = "<span>‚ñ∂</span> Nghe Voice"; // Quay l·∫°i tr·∫°ng th√°i ban ƒë·∫ßu
                }
            }
        });
    </script>
</body>
</html>
